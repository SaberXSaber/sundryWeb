!function(window){function getClassList(element){return element.className?element.className.split(/\s+/):[]}function returnTrue(){return!0}function returnFalse(){return!1}function isObject(target){return"[object Object]"===Object.prototype.toString.call(target)}function Event(type,args){"object"==typeof type&&(args=type,type=args.type),isObject(args)?lib.extend(this,args):args&&(this.data=args),type&&(this.type=type)}function isContextIdentical(context,handler,thisObject){return context&&context.handler===handler&&context.thisObject==thisObject}function EventQueue(){this.queue=[]}function EventTarget(){}function ControlCollection(){this.length=0}function SafeWrapper(){}function ControlGroup(name){ControlCollection.apply(this,arguments),this.name=name}function addToGroup(control,group){ControlCollection.prototype.add.call(group,control)}function removeFromGroup(control,group){ControlCollection.prototype.remove.call(group,control)}function getGroupNames(control){var group=control.get("group");return group?group.split(/[\t\r\n ]/):[]}function getGUID(){return"vt"+counter++}function ViewContext(id){if(this.controls={},this.groups={},id=id||getGUID(),pool.hasOwnProperty(id)){for(var i=1,prefix=id+"-";pool.hasOwnProperty(prefix+i);)i++;id=prefix+i}this.id=id,pool[this.id]=this}function registerClass(classFunc,container){if("function"==typeof classFunc){var type=classFunc.prototype.type;if(type in container)throw new Error(type+" is exists!");container[type]=classFunc}}function createInstance(type,options,container){var Constructor=container[type];return Constructor?(delete options.type,new Constructor(options)):null}function Rule(){}function Validity(){this.states=[],this.stateIndex={},this.customMessage="",this.customValidState=null}function ValidityState(state,message){this.state=state,this.message=message||""}function RequiredRule(){Rule.apply(this,arguments)}function PatternRule(){Rule.apply(this,arguments)}function MinRule(){Rule.apply(this,arguments)}function MinLengthRule(){Rule.apply(this,arguments)}function MinByteLengthRule(){Rule.apply(this,arguments)}function MaxRule(){Rule.apply(this,arguments)}function MaxLengthRule(){Rule.apply(this,arguments)}function MaxByteLengthRule(){Rule.apply(this,arguments)}function getControlClassType(control){var type=control.styleType||control.type;return type.toLowerCase()}function joinByStrike(){return[].slice.call(arguments,0).join("-")}function getGlobalEventPool(element){return element===window?globalEvents.window:element===document?globalEvents.document:element===document.documentElement?globalEvents.documentElement:element===document.body?globalEvents.body:null}function triggerGlobalDOMEvent(element,e){var pool=getGlobalEventPool(element);if(pool){var queue=pool[e.type];queue&&u.each(queue,function(control){control&&triggerDOMEvent(control,element,e)})}}function debounce(fn,interval){interval=interval||150;var timer=0;return function(e){clearTimeout(timer);var self=this;e=e||window.event,e={type:e.type,srcElement:e.srcElement,target:e.target,currentTarget:e.currentTarget},timer=setTimeout(function(){fn.call(self,e)},interval)}}function addGlobalDOMEvent(control,type,element){var pool=getGlobalEventPool(element);if(!pool)return!1;var controls=pool[type];if(!controls){controls=pool[type]=[];var handler=u.partial(triggerGlobalDOMEvent,element);"resize"!==type&&"scroll"!==type||(handler=debounce(handler)),controls.handler=handler,lib.on(element,type,controls.handler)}if(!(u.indexOf(controls,control)>=0))return controls.push(control),!0}function removeGlobalDOMEvent(control,type,element){var pool=getGlobalEventPool(element);if(!pool)return!1;if(!pool[type])return!0;for(var controls=pool[type],i=0;i<controls.length;i++)if(controls[i]===control){controls[i]=null;break}var isQueueEmpty=u.every(controls,function(control){return null==control});if(isQueueEmpty){var handler=controls.handler;lib.un(element,type,handler),pool[type]=null}return!0}function triggerDOMEvent(control,element,e){e=e||window.event;var isInIgnoringState=u.some(function(state){return console.info(control.hasState(state)),control.hasState(state)});if(!isInIgnoringState){e.target||(e.target=e.srcElement),e.currentTarget||(e.currentTarget=element),e.preventDefault||(e.preventDefault=function(){e.returnValue=!1}),e.stopPropagation||(e.stopPropagation=function(){e.cancelBubble=!0});var queue=control.domEvents[e.currentTarget[DOM_EVENTS_KEY]][e.type];queue&&queue.execute(e,control)}}function Helper(control){this.control=control}function Layer(control){this.control=control}function close(e){var target=e.target,layer=this.getElement(this),main=this.control.main;if(layer){for(;target&&target!==layer&&target!==main;)target=target.parentNode;target!==layer&&target!==main&&this.hide()}}function getHiddenClasses(layer){var classes=layer.control.helper.getPartClasses("layer-hidden");return classes.unshift(ui.getConfig("uiClassPrefix")+"-layer-hidden"),classes}function positionLayerElement(element,options){var properties=lib.clone(options||{});properties.hasOwnProperty("top")&&properties.hasOwnProperty("bottom")&&(properties.height=properties.bottom-properties.top,delete properties.bottom),properties.hasOwnProperty("left")&&properties.hasOwnProperty("right")&&(properties.width=properties.right-properties.left,delete properties.right),(properties.hasOwnProperty("top")||properties.hasOwnProperty("bottom"))&&(element.style.top="",element.style.bottom=""),(properties.hasOwnProperty("left")||properties.hasOwnProperty("right"))&&(element.style.left="",element.style.right="");for(var name in properties)properties.hasOwnProperty(name)&&(element.style[name]=properties[name]+"px")}function Control(options){options=options||{},this.helper=new Helper(this),this.helper.changeStage("NEW"),this.children=[],this.childrenIndex={},this.currentStates={},this.domEvents={},this.main=options.main?options.main:this.createMain(options),this.id||options.id||(this.id=lib.getGUID()),this.initOptions(options),this.helper.initViewContext(),this.helper.initExtensions(),this.helper.changeStage("INITED"),this.fire("init",{options:options})}function ValidityLabel(){Control.apply(this,arguments)}function getClasses(label,state){var target=label.target,targetHelper=null;if(target||label.targetType){var targetContext={type:label.targetType||target.type,skin:target&&target.skin};targetHelper=new Helper(targetContext)}var classes=label.helper.getPartClasses();return targetHelper&&classes.push.apply(classes,targetHelper.getPartClasses("validity-label")),state&&(classes.push.apply(classes,label.helper.getPartClasses(state)),targetHelper&&classes.push.apply(classes,targetHelper.getPartClasses("validity-label-"+state))),(target&&target.isHidden()||label.isHidden())&&(classes.push.apply(classes,label.helper.getStateClasses("hidden")),target&&classes.push.apply(classes,target.helper.getPartClasses("validity-label-hidden"))),classes}function InputControl(options){options=options?lib.extend({},options):{},options.main&&!options.name&&(options.name=options.main.getAttribute("name")),Control.call(this,options)}function Schedule(options){InputControl.apply(this,arguments)}function shortcut(){function selectByDayStates(dayStates){for(var value=[],i=0;7>i&&i<dayStates.length;i++){value[i]=[];for(var j=0;24>j;j++)value[i][j]=dayStates[i]}return value}return[{text:"全周投放",tip:"周一到周日全天投放",getValue:function(){return selectByDayStates([1,1,1,1,1,1,1])}},{text:"周一到周五投放",tip:"周一到周五全天投放",getValue:function(){return selectByDayStates([1,1,1,1,1,0,0])}},{text:"周末投放",tip:"周六、周日全天投放",getValue:function(){return selectByDayStates([0,0,0,0,0,1,1])}}]}function initValue(){for(var value=[],i=0;7>i;i++){var lineValue=[];value.push(lineValue);for(var j=0;24>j;j++)lineValue.push(0)}return value}function getClass(schedule,part){return helper.getPartClasses(schedule,part).join(" ")}function getId(schedule,part){return helper.getId(schedule,part)}function getShortcutHtml(schedule){var me=schedule,html=[],tpl='<span class="${clazz}" data-item="${index}" >${text}</span>',textClass=getClass(me,"shortcut-text-item");html.push('<span class="'+textClass+'">快速设定：</span>');for(var shortcuts=me.shortcut,clazz=getClass(me,"shortcut-item"),i=0,len=shortcuts.length;len>i;i++){var shortcut=shortcuts[i];html.push(lib.format(tpl,{clazz:clazz,text:shortcut.text,index:i}))}return html.join("")}function initBody(schedule){lib.g(getId(schedule,"body")).innerHTML=""+getBodyTimeHtml(schedule)+getBodyDayHtml(schedule)+getBodyItemHtml(schedule)}function getBodyTimeHtml(schedule){var me=schedule,html=[],timelineClass=getClass(me,"time-line"),bodyHeadId=getId("body-head");html.push('<div class="',timelineClass,'" id="',bodyHeadId+'">');for(var timeHClass=getClass(me,"time-head"),i=0;24>=i;i+=2)html.push('<div class="',timeHClass,'" data-time="',i,'" ','id="',getId(me,"time-head"+i),'">',i,"</div>");return html.push("</div>"),html.join("")}function getBodyDayHtml(schedule){var me=schedule,html=[],dayHClass=getClass(me,"day-head"),dayHId=getId(me,"day-head");html.push('<div id="',dayHId,'" class="',dayHClass,'">');for(var dayClass=getClass(me,"day"),dayTpl='<div class="'+dayClass+'"><input type="checkbox" id="${dayId}" value="${value}">&nbsp;<label for="${dayId}">${dayWord}</label></div>',dayTexts=me.dayTexts,i=0;7>i;i++)html.push(lib.format(dayTpl,{dayWord:dayTexts[i],dayId:getId(me,"line-state"+i),value:i}));return html.push("</div>"),html.join("")}function getBodyItemHtml(schedule){var me=schedule,html=[],timeTpl='<div class="${timeClass}" id="${itemId}" data-day="${dayIndex}" data-time-item="1" data-time="${timeIndex}"></div>',timeBClass=getClass(me,"time-body"),timeBId=getId(me,"time-body");html.push('<div id="',timeBId,'" class="',timeBClass,'">');for(var lineClass=getClass(me,"line"),i=0;7>i;i++){var lineId=getId(me,"line"+i);html.push('<div class="',lineClass,'" id="',lineId,'">');for(var j=0;24>j;j++){var itemId=getId(me,"time_"+i+"_"+j);html.push(lib.format(timeTpl,{itemId:itemId,timeClass:getClass(me,"time"),dayIndex:i,timeIndex:j}))}html.push("</div>")}return html.push("</div>"),html.join("")}function repaintView(schedule,value){for(var me=schedule,selectedClass=helper.getPartClasses(me,"time-selected"),hoverClass=helper.getPartClasses(me,"time-hover"),i=0;7>i;i++){var statusArr=[],lineEl=lib.g(getId(me,"line"+i));removeSelectedLineCoverTip(schedule,lineEl);for(var j=0;24>j;j++){var item=lib.g(getId(me,"time_"+i+"_"+j)),val=value[i][j];val?lib.addClasses(item,selectedClass):lib.removeClasses(item,selectedClass),lib.removeClasses(item,hoverClass),statusArr.push(val)}createSelectedLineCoverTip(me,statusArr,lineEl,i)}}function createSelectedLineCoverTip(schedule,arr,parent,index){var me=schedule,i=index,checkInput=lib.g(getId(me,"line-state"+i));checkInput.checked=!1;for(var result,patt=/1{3,}/g,statusStr=arr.join(""),coverClass=getClass(me,"continue-covertimes"),coverTpl='<div class="${coverClass}"><strong>${text}</strong></div>';null!=(result=patt.exec(statusStr));){var length=result[0].length,start=result.index,end=start+length,coverDiv=document.createElement("aside"),cssStyle=";width:"+25*length+"px;top:0;left:"+25*start+"px;";checkInput.checked=24===length,coverDiv.setAttribute("data-start-time",start),coverDiv.setAttribute("data-end-time",end),coverDiv.setAttribute("data-day",i),coverDiv.className=coverClass,coverDiv.style.cssText+=cssStyle,coverDiv.innerHTML=lib.format(coverTpl,{start:start,end:end,text:24===length?"全天投放":start+":00-"+end+":00",coverClass:getClass(me,"covertimes-tip")}),parent.appendChild(coverDiv),helper.addDOMEvent(me,coverDiv,"mouseover",lib.curry(coverTipOverHandler,coverDiv)),helper.addDOMEvent(me,coverDiv,"mouseout",lib.curry(coverTipOutHandler,coverDiv))}}function coverTipOverHandler(element,e){element.style.opacity="0",element.style.cursor="pointer"}function coverTipOutHandler(element,e){element.style.opacity="0.5"}function removeSelectedLineCoverTip(schedule,parent){for(var removeDiv=parent.getElementsByTagName("aside"),len=removeDiv.length;len;){var item=removeDiv[0];null!=item.getAttribute("data-day")&&(helper.clearDOMEvents(schedule,item),parent.removeChild(item)),len--}}function showPromptTip(schedule,tipId,mousepos,tipText){var me=schedule;tipId=tipId||getId(me,"tip");var tipElement=lib.g(tipId);if(tipElement)tipElement.style.top=mousepos.y+"px",tipElement.style.left=mousepos.x+"px",tipElement.innerHTML=tipText;else{var cssStyle=";position:absolute;z-index:5000;background:#fff6bd;top:"+mousepos.y+"px;left:"+mousepos.x+"px;display:none;",tipClass=getClass(me,"shortcut-item-tip");tipElement=document.createElement("div"),tipElement.style.cssText=cssStyle,tipElement.id=tipId,tipElement.className=tipClass,tipElement.innerHTML=tipText,document.body.appendChild(tipElement),me.followTip[tipId]=tipElement}return me.tipElementTime=setTimeout(function(){tipElement.style.display="block"},100),tipElement}function hidePromptTip(schedule,tipId){clearTimeout(schedule.tipElementTime);var tip=lib.g(tipId);tip&&(tip.style.display="none")}function dayClickHandler(e){var target=lib.event.getTarget(e);if("input"===target.nodeName.toLowerCase()){if(this.disabled)return!1;for(var me=this,dom=target,dayIndex=parseInt(dom.value,10),dayState=dom.checked,rawValueCopy=rawValueClone(me.rawValue),timeValue=rawValueCopy[dayIndex],i=0,len=timeValue.length;len>i;i++)timeValue[i]=dayState?1:0;me.setRawValue(rawValueCopy)}}function shortcutClickHandler(e){var target=lib.event.getTarget(e);if(target&&lib.hasAttribute(target,"data-item")&&!this.disabled){var index=target.getAttribute("data-item"),func=this.shortcut[index].getValue;"function"==typeof func&&func.call(this);var rawValue;rawValue="function"==typeof func?func.call(this):func,this.setRawValue(rawValue)}}function shortcutMoveHandler(e){var target=lib.event.getTarget(e);if(target&&target.getAttribute("data-item")){if(this.disabled)return!1;var element=target,me=this;lib.event.getMousePosition(e);var mousepos={};mousepos.y=e.pageY+20,mousepos.x=e.pageX+10;var dom=element,index=dom.getAttribute("data-item"),tipId=getId(me,"shortcut-item")+index;setTimeout(function(){var tipElement=lib.g(tipId);tipElement&&(tipElement.style.top=mousepos.y+"px",tipElement.style.left=mousepos.x+"px")},0)}}function shortcutOverOutHandler(isOver,e){var target=lib.event.getTarget(e);if(target&&target.getAttribute("data-item")){if(this.disabled)return!1;var element=target;lib.event.getMousePosition(e);var mousepos={};mousepos.y=e.pageY+20,mousepos.x=e.pageX+10;var me=this,dom=element,index=dom.getAttribute("data-item"),tipId=getId(me,"shortcut-item")+index,clazz=helper.getPartClasses(me,"shortcut-item-hover");if(isOver){lib.addClasses(dom,clazz);var tipText=me.shortcut[index].tip;showPromptTip(me,tipId,mousepos,tipText)}else lib.removeClasses(dom,clazz),hidePromptTip(me,tipId)}}function timeOverHandler(e){var target=lib.event.getTarget(e);if(target&&target.getAttribute("data-time-item")){if(this.disabled)return!1;var element=target;lib.addClasses(element,helper.getPartClasses(this,"time-hover")),lib.event.getMousePosition(e);var mousepos={};mousepos.y=e.pageY+20,mousepos.x=e.pageX+10;var me=this,time=parseInt(element.getAttribute("data-time"),10),day=parseInt(element.getAttribute("data-day"),10),tipText=lib.format(timeTipTpl,{time:"<strong>"+time+":00</strong>&nbsp;—&nbsp;<strong>"+(time+1)+":00</strong>",text:"点击/拖动鼠标选择",timeId:getId(me,"timeitem-tip-head"),textId:getId(me,"timeitem-tip-body"),timeClass:getClass(me,"timeitem-tip-head"),textClass:getClass(me,"timeitem-tip-body")}),tipId=getId(me,"timeitem-tip");showPromptTip(me,tipId,mousepos,tipText);for(var timebody=lib.g(getId(me,"time-body")),timeCovers=timebody.getElementsByTagName("aside"),i=0,len=timeCovers.length;len>i;i++){var item=timeCovers[i],startCT=parseInt(item.getAttribute("data-start-time"),10),endCT=parseInt(item.getAttribute("data-end-time"),10),coverDay=parseInt(item.getAttribute("data-day"),10);time>=startCT&&endCT>time&&day===coverDay?item.style.display="none":item.style.display="block"}}}function timeOutHandler(e){var target=lib.event.getTarget(e);if(target&&target.getAttribute("data-time-item")){if(this.disabled)return!1;lib.removeClasses(target,helper.getPartClasses(this,"time-hover")),hidePromptTip(this,getId(this,"timeitem-tip"))}}function timeBodyDownHandler(e){if(this.disabled)return!1;var me=this,doc=document;getTimeBodyMoveHandler=lib.bind(timeBodyMoveHandler,me),getTimeBodyUpHandler=lib.bind(timeBodyUpHandler,me),lib.on(doc,"mousemove",getTimeBodyMoveHandler),lib.on(doc,"mouseup",getTimeBodyUpHandler),lib.event.getMousePosition(e),this.dragStartPos={x:e.pageX,y:e.pageY};var timebody=lib.g(getId(me,"time-body"));me.dragRange=[];var timebodyTop=lib.getOffset(timebody).top,timebodyLeft=lib.getOffset(timebody).left;me.dragRange.push(timebodyTop),me.dragRange.push(timebodyLeft+timebody.offsetWidth),me.dragRange.push(timebodyTop+timebody.offsetHeight),me.dragRange.push(timebodyLeft),ondragHuck(timebody);var cellPos=getTragTimeCellPos(this,{x:e.pageX,y:e.pageY}),tipId=getId(me,"timeitem-tip");lib.g(tipId)&&(lib.g(tipId).style.display="none"),repaintFollowEle(this,cellPos)}function timeBodyMoveHandler(e){lib.event.getMousePosition(e);var cellPos=getTragTimeCellPos(this,{x:e.pageX,y:e.pageY});repaintFollowEle(this,cellPos)}function timeBodyUpHandler(e){var me=this;offDragHuck(lib.g(getId(me,"time-body")));var followEle=lib.g(getId(me,"follow-item"));followEle.style.display="none",lib.event.getMousePosition(e);var cellPos=getTragTimeCellPos(me,{x:e.pageX,y:e.pageY});setTimeout(function(){setSelectedAreaValue(me,cellPos)},10);var doc=document;lib.un(doc,"mousemove",getTimeBodyMoveHandler),lib.un(doc,"mouseup",getTimeBodyUpHandler)}function setSelectedAreaValue(schedule,cellPos){for(var me=schedule,startcell=cellPos.startcell,endcell=cellPos.endcell,minXCell=Math.min(startcell.x,endcell.x),minYCell=Math.min(startcell.y,endcell.y),maxXCell=Math.max(startcell.x,endcell.x),maxYCell=Math.max(startcell.y,endcell.y),rawValueCopy=rawValueClone(me.rawValue),i=minYCell;maxYCell>=i;i++)for(var j=minXCell;maxXCell>=j;j++)rawValueCopy[i][j]?rawValueCopy[i][j]=0:rawValueCopy[i][j]=1;me.setRawValue(rawValueCopy)}function getTragTimeCellPos(schedule,mousepos){var me=schedule,timeBodyPos=me.dragRange,dragStartPos=me.dragStartPos,rangePos={};mousepos.x<=timeBodyPos[1]&&mousepos.x>=timeBodyPos[3]?rangePos.x=mousepos.x:rangePos.x=mousepos.x-dragStartPos.x<0?timeBodyPos[3]:timeBodyPos[1],mousepos.y<=timeBodyPos[2]&&mousepos.y>=timeBodyPos[0]?rangePos.y=mousepos.y:rangePos.y=mousepos.y-dragStartPos.y<0?timeBodyPos[0]:timeBodyPos[2];var cellrange={startcell:{},endcell:{}};return cellrange.startcell.x=Math.floor((dragStartPos.x-me.dragRange[3])/25),cellrange.startcell.y=Math.floor((dragStartPos.y-me.dragRange[0])/25),cellrange.endcell.x=Math.floor((rangePos.x-me.dragRange[3])/25),cellrange.endcell.y=Math.floor((rangePos.y-me.dragRange[0])/25),cellrange.endcell.x>=23&&(cellrange.endcell.x=23),cellrange.endcell.y>=6&&(cellrange.endcell.y=6),cellrange}function repaintFollowEle(schedule,cellPos){var me=schedule,followEleId=getId(schedule,"follow-item"),followEle=lib.g(followEleId);followEle||(followEle=document.createElement("div"),followEle.className=getClass(me,"follow-item"),followEle.id=followEleId,lib.g(getId(me,"time-body")).appendChild(followEle));var divTop,divLeft,divHeight,divWidth,startcell=cellPos.startcell,endcell=cellPos.endcell,startcellX=startcell.x,startcellY=startcell.y,endcellX=endcell.x,endcellY=endcell.y;endcellY>=startcellY?(divTop=25*startcellY,divHeight=25*(endcellY-startcellY+1)-2):(divTop=25*endcellY,divHeight=25*(startcellY-endcellY+1)-2),endcellX>=startcellX?(divLeft=25*startcellX,divWidth=25*(endcellX-startcellX+1)-2):(divLeft=25*endcellX,divWidth=25*(startcellX-endcellX+1)-2);var cssStyles=";display:block;;width:"+divWidth+"px;height:"+divHeight+"px;top:"+divTop+"px;left:"+divLeft+"px;background:#faffbe";followEle.style.cssText+=cssStyles}function ondragHuck(target){var doc=document;lib.on(doc,"selectstart",dragUnSelect),target.setCapture?target.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),document.selection?document.selection.empty&&document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}function offDragHuck(target){var doc=document;target.releaseCapture?target.releaseCapture():window.releaseEvents&&window.releaseEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),lib.un(doc,"selectstart",dragUnSelect)}function dragUnSelect(e){lib.event.preventDefault(e)}function rawValueClone(rawValue){for(var val=[],i=0,len=rawValue.length;len>i;i++)val.push([].slice.call(rawValue[i],0));return val}function setDayCheckboxState(schedule,state,value){for(var dayHead=lib.g(getId(schedule,"day-head")),inputs=dayHead.getElementsByTagName("input"),i=0,len=inputs.length;len>i;i++)inputs[i][state]=value}function dealValueByCoord(schedule,isSelect,coord){for(var rawValueCopy=rawValueClone(schedule.rawValue),i=0,len=coord.length;len>i;i++){var item=coord[i];null!=rawValueCopy[item[0]]&&null!=rawValueCopy[item[0]][item[1]]&&(rawValueCopy[item[0]][item[1]]=isSelect?1:0)}schedule.setRawValue(rawValueCopy)}var u=_,lib={},WHITESPACE=/^[\s\xa0\u3000]+|[\u3000\xa0\s]+$/g;lib.trim=function(source){return source?String(source).replace(WHITESPACE,""):""},lib.format=function(template,data){return template?null==data?template:template.replace(/\$\{(.+?)\}/g,function(match,key){var replacer=data[key];return"function"==typeof replacer&&(replacer=replacer(key)),null==replacer?"":replacer}):""},lib.camelize=function(source){return source?source.replace(/-([a-z])/g,function(match,alpha){return alpha.toUpperCase()}):""},lib.pascalize=function(source){return source?source.charAt(0).toUpperCase()+lib.camelize(source.slice(1)):""},lib.splitTokenList=function(input){if(!input)return[];if(!u.isArray(input))return u.chain(input.split(/[,\s]/)).map(lib.trim).compact().value()};var documentElement=document.documentElement,body=document.body,viewRoot="BackCompat"===document.compatMode?body:documentElement,page={};page.getWidth=function(){return Math.max(documentElement?documentElement.scrollWidth:0,body?body.scrollWidth:0,viewRoot?viewRoot.clientWidth:0,0)},page.getHeight=function(){return Math.max(documentElement?documentElement.scrollHeight:0,body?body.scrollHeight:0,viewRoot?viewRoot.clientHeight:0,0)},page.getViewWidth=function(){return viewRoot?viewRoot.clientWidth:0},page.getViewHeight=function(){return viewRoot?viewRoot.clientHeight:0},page.getScrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},page.getScrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},page.getClientTop=function(){return document.documentElement.clientTop||document.body.clientTop||0},page.getClientLeft=function(){return document.documentElement.clientLeft||document.body.clientLeft||0},lib.page=page;var counter=8785925;lib.getGUID=function(prefix){return prefix=prefix||"esui",prefix+counter++},lib.inherits=function(subClass,superClass){var Empty=function(){};Empty.prototype=superClass.prototype;var selfPrototype=subClass.prototype,proto=subClass.prototype=new Empty;for(var key in selfPrototype)proto[key]=selfPrototype[key];return subClass.prototype.constructor=subClass,subClass.superClass=superClass.prototype,subClass},lib.clone=function(source){if(!source||"object"!=typeof source)return source;var result=source;if(u.isArray(source))result=u.clone(source);else if("[object Object]"==={}.toString.call(source)&&"isPrototypeOf"in source){result={};for(var key in source)source.hasOwnProperty(key)&&(result[key]=lib.deepClone(source[key]))}return result},lib.deepClone=lib.clone,lib.toDictionary=function(array){var dictionary={};return u.each(array,function(value){dictionary[value]=!0}),dictionary},lib.isArray=u.isArray,lib.toArray=u.toArray,lib.extend=u.extend,lib.bind=u.bind,lib.curry=u.partial,lib.indexOf=u.indexOf,lib.decodeHTML=u.unescape,lib.encodeHTML=u.escape,lib.g=function(id){return id?"string"==typeof id?document.getElementById(id):id:null},lib.isInput=function(element){var nodeName=element.nodeName.toLowerCase();return"input"===nodeName||"select"===nodeName||"textarea"===nodeName},lib.removeNode=function(element){if("string"==typeof element&&(element=lib.g(element)),element){var parent=element.parentNode;parent&&parent.removeChild(element)}},lib.insertAfter=function(element,reference){var parent=reference.parentNode;return parent&&parent.insertBefore(element,reference.nextSibling),element},lib.insertBefore=function(element,reference){var parent=reference.parentNode;return parent&&parent.insertBefore(element,reference),element},lib.getChildren=function(element){return u.filter(element.children,function(child){return 1===child.nodeType})},lib.getComputedStyle=function(element,key){if(!element)return"";var doc=9===element.nodeType?element:element.ownerDocument||element.document;if(doc.defaultView&&doc.defaultView.getComputedStyle){var styles=doc.defaultView.getComputedStyle(element,null);if(styles)return styles[key]||styles.getPropertyValue(key)}else if(element&&element.currentStyle)return element.currentStyle[key];return""},lib.getStyle=function(element,key){return key=string.camelize(key),element.style[key]||(element.currentStyle?element.currentStyle[key]:"")||lib.getComputedStyle(element,key)},lib.getOffset=function(element){var rect=element.getBoundingClientRect(),offset={top:rect.top,right:rect.right,bottom:rect.bottom,left:rect.left,width:rect.right-rect.left,height:rect.bottom-rect.top},clientTop=document.documentElement.clientTop||document.body.clientTop||0,clientLeft=document.documentElement.clientLeft||document.body.clientLeft||0,scrollTop=window.pageYOffset||document.documentElement.scrollTop,scrollLeft=window.pageXOffset||document.documentElement.scrollLeft;return offset.top=offset.top+scrollTop-clientTop,offset.bottom=offset.bottom+scrollTop-clientTop,offset.left=offset.left+scrollLeft-clientLeft,offset.right=offset.right+scrollLeft-clientLeft,offset},lib.getText=function(element){var text="";return 3===element.nodeType||4===element.nodeType?text+=element.nodeValue:8!==element.nodeType&&u.each(element.childNodes,function(child){text+=lib.getText(child)}),text},lib.dom={},lib.dom.first=function(element){if(element=lib.g(element),element.firstElementChild)return element.firstElementChild;for(var node=element.firstChild;node;node=node.nextSibling)if(1===node.nodeType)return node;return null},lib.dom.last=function(element){if(element=lib.g(element),element.lastElementChild)return element.lastElementChild;for(var node=element.lastChild;node;node=node.previousSibling)if(1===node.nodeType)return node;return null},lib.dom.next=function(element){if(element=lib.g(element),element.nextElementSibling)return element.nextElementSibling;for(var node=element.nextSibling;node;node=node.nextSibling)if(1===node.nodeType)return node;return null},lib.dom.contains=function(container,contained){return container=lib.g(container),contained=lib.g(contained),container.contains?container!==contained&&container.contains(contained):!!(16&container.compareDocumentPosition(contained))},lib.hasClass=function(element,className){if(element=lib.g(element),""===className)throw new Error("className must not be empty");if(!element||!className)return!1;if(element.classList)return element.classList.contains(className);var classes=getClassList(element);return u.includes(classes,className)},lib.addClass=function(element,className){if(element=lib.g(element),""===className)throw new Error("className must not be empty");if(!element||!className)return element;if(element.classList)return element.classList.add(className),element;var classes=getClassList(element);return u.includes(classes,className)?element:(classes.push(className),element.className=classes.join(" "),element)},lib.addClasses=function(element,classes){if(element=lib.g(element),!element||!classes)return element;if(element.classList)return u.each(classes,function(className){element.classList.add(className)}),element;var originalClasses=getClassList(element),newClasses=u.union(originalClasses,classes);return newClasses.length>originalClasses.length&&(element.className=newClasses.join(" ")),element},lib.removeClass=function(element,className){if(element=lib.g(element),""===className)throw new Error("className must not be empty");if(!element||!className)return element;if(element.classList)return element.classList.remove(className),element;for(var classes=getClassList(element),changed=!1,i=0;i<classes.length;i++)classes[i]===className&&(classes.splice(i,1),i--,changed=!0);return changed&&(element.className=classes.join(" ")),element},lib.removeClasses=function(element,classes){if(element=lib.g(element),!element||!classes)return element;if(element.classList)return u.each(classes,function(className){element.classList.remove(className)}),element;var originalClasses=getClassList(element),newClasses=u.difference(originalClasses,classes);return newClasses.length<originalClasses.length&&(element.className=newClasses.join(" ")),element},lib.toggleClass=function(element,className){if(element=lib.g(element),""===className)throw new Error("className must not be empty");if(!element||!className)return element;if(element.classList)return element.classList.toggle(className),element;for(var classes=getClassList(element),containsClass=!1,i=0;i<classes.length;i++)classes[i]===className&&(classes.splice(i,1),containsClass=!0,i--);return containsClass||classes.push(className),element.className=classes.join(" "),element},lib.hasAttribute=function(element,name){return element.hasAttribute?element.hasAttribute(name):element.attributes&&element.attributes[name]&&element.attributes[name].specified};var ATTRIBUTE_NAME_MAPPING=function(){var result={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"},div=document.createElement("div");div.innerHTML='<label for="test" class="test"></label>';var label=div.getElementsByTagName("label")[0];return"test"===label.getAttribute("className")?result["class"]="className":result.className="class","test"===label.getAttribute("for")?result.htmlFor="for":result["for"]="htmlFor",result}();lib.setAttribute=function(element,key,value){return element=lib.g(element),"style"===key?element.style.cssText=value:(key=ATTRIBUTE_NAME_MAPPING[key]||key,element.setAttribute(key,value)),element},lib.getAttribute=function(element,key){return element=lib.g(element),"style"===key?element.style.cssText:(key=ATTRIBUTE_NAME_MAPPING[key]||key,element.getAttribute(key))},lib.removeAttribute=function(element,key){element=lib.g(element),key=ATTRIBUTE_NAME_MAPPING[key]||key,element.removeAttribute(key)},Event.prototype.isDefaultPrevented=returnFalse,Event.prototype.preventDefault=function(){this.isDefaultPrevented=returnTrue},Event.prototype.isPropagationStopped=returnFalse,Event.prototype.stopPropagation=function(){this.isPropagationStopped=returnTrue},Event.prototype.isImmediatePropagationStopped=returnFalse,Event.prototype.stopImmediatePropagation=function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()};var globalWindow=function(){return this}();Event.fromDOMEvent=function(domEvent,type,args){domEvent=domEvent||globalWindow.event;var event=new Event(type,args);return event.preventDefault=function(){domEvent.preventDefault?domEvent.preventDefault():domEvent.returnValue=!1,Event.prototype.preventDefault.call(this)},event.stopPropagation=function(){domEvent.stopPropagation?domEvent.stopPropagation():domEvent.cancelBubble=!0,Event.prototype.stopPropagation.call(this)},event.stopImmediatePropagation=function(){domEvent.stopImmediatePropagation&&domEvent.stopImmediatePropagation(),Event.prototype.stopImmediatePropagation.call(this)},event};var EVENT_PROPERTY_BLACK_LIST={type:!0,target:!0,preventDefault:!0,isDefaultPrevented:!0,
stopPropagation:!0,isPropagationStopped:!0,stopImmediatePropagation:!0,isImmediatePropagationStopped:!0};Event.fromEvent=function(originalEvent,options){var defaults={type:originalEvent.type,preserveData:!1,syncState:!1};options=lib.extend(defaults,options);var newEvent=new Event(options.type);if(options.preserveData)for(var key in originalEvent)originalEvent.hasOwnProperty(key)&&!EVENT_PROPERTY_BLACK_LIST.hasOwnProperty(key)&&(newEvent[key]=originalEvent[key]);return options.extend&&lib.extend(newEvent,options.extend),options.syncState&&(newEvent.preventDefault=function(){originalEvent.preventDefault(),Event.prototype.preventDefault.call(this)},newEvent.stopPropagation=function(){originalEvent.stopPropagation(),Event.prototype.stopPropagation.call(this)},newEvent.stopImmediatePropagation=function(){originalEvent.stopImmediatePropagation(),Event.prototype.stopImmediatePropagation.call(this)}),newEvent},Event.delegate=function(from,fromType,to,toType,options){var useDifferentType="string"==typeof fromType,source={object:from,type:useDifferentType?fromType:to},target={object:useDifferentType?to:fromType,type:useDifferentType?toType:to},config=useDifferentType?options:toType;if(config=lib.extend({preserveData:!1},config),"function"==typeof source.object.on&&"function"==typeof target.object.on&&"function"==typeof target.object.fire){var delegator=function(originalEvent){var event=Event.fromEvent(originalEvent,config);event.type=target.type,event.target=target.object,target.object.fire(target.type,event)};source.object.on(source.type,delegator)}},EventQueue.prototype.add=function(handler,options){if(handler!==!1&&"function"!=typeof handler)throw new Error("event handler must be a function or const false");var wrapper={handler:handler};lib.extend(wrapper,options);for(var i=0;i<this.queue.length;i++){var context=this.queue[i];if(isContextIdentical(context,handler,wrapper.thisObject))return}this.queue.push(wrapper)},EventQueue.prototype.remove=function(handler,thisObject){if(!handler)return void this.clear();for(var i=0;i<this.queue.length;i++){var context=this.queue[i];if(isContextIdentical(context,handler,thisObject))return void(this.queue[i]=null)}},EventQueue.prototype.clear=function(){this.queue.length=0},EventQueue.prototype.execute=function(event,thisObject){for(var queue=this.queue,i=0;i<queue.length;i++){if("function"==typeof event.isImmediatePropagationStopped&&event.isImmediatePropagationStopped())return;var context=queue[i];if(context){var handler=context.handler;handler===!1?("function"==typeof event.preventDefault&&event.preventDefault(),"function"==typeof event.stopPropagation&&event.stopPropagation()):handler.call(context.thisObject||thisObject,event),context.once&&this.remove(context.handler,context.thisObject)}}},EventQueue.prototype.getLength=function(){for(var count=0,i=0;i<this.queue.length;i++)this.queue[i]&&count++;return count},EventQueue.prototype.length=EventQueue.prototype.getLength,EventQueue.prototype.dispose=function(){this.clear(),this.queue=null},EventTarget.prototype.on=function(type,fn,thisObject,options){this.miniEventPool||(this.miniEventPool={}),this.miniEventPool.hasOwnProperty(type)||(this.miniEventPool[type]=new EventQueue);var queue=this.miniEventPool[type];options=lib.extend({},options),thisObject&&(options.thisObject=thisObject),queue.add(fn,options)},EventTarget.prototype.once=function(type,fn,thisObject,options){options=lib.extend({},options),options.once=!0,this.on(type,fn,thisObject,options)},EventTarget.prototype.un=function(type,handler,thisObject){if(this.miniEventPool&&this.miniEventPool.hasOwnProperty(type)){var queue=this.miniEventPool[type];queue.remove(handler,thisObject)}},EventTarget.prototype.fire=function(type,args){if(1===arguments.length&&"object"==typeof type&&(args=type,type=args.type),!type)throw new Error("No event type specified");if("*"===type)throw new Error("Cannot fire global event");var event=args instanceof Event?args:new Event(type,args);event.target=this;var inlineHandler=this["on"+type];if("function"==typeof inlineHandler&&inlineHandler.call(this,event),this.miniEventPool&&this.miniEventPool.hasOwnProperty(type)){var queue=this.miniEventPool[type];queue.execute(event,this)}if(this.miniEventPool&&this.miniEventPool.hasOwnProperty("*")){var globalQueue=this.miniEventPool["*"];globalQueue.execute(event,this)}return event},EventTarget.prototype.destroyEvents=function(){if(this.miniEventPool){for(var name in this.miniEventPool)this.miniEventPool.hasOwnProperty(name)&&this.miniEventPool[name].dispose();this.miniEventPool=null}},EventTarget.enable=function(target){target.miniEventPool={},lib.extend(target,EventTarget.prototype)};var event={};event.preventDefault=function(event){event=event||window.event,event.preventDefault?event.preventDefault():event.returnValue=!1},event.stopPropagation=function(event){event=event||window.event,event.stopPropagation?event.stopPropagation():event.cancelBubble=!0},event.getMousePosition=function(event){return event=event||window.event,"number"!=typeof event.pageX&&(event.pageX=event.clientX+lib.page.getScrollLeft()-lib.page.getClientLeft()),"number"!=typeof event.pageY&&(event.pageY=event.clientY+lib.page.getScrollTop()-lib.page.getClientTop()),event},event.getTarget=function(event){return event=event||window.event,event.target||event.srcElement},lib.on=function(element,type,listener){element=lib.g(element),element.addEventListener?element.addEventListener(type,listener,!1):element.attachEvent&&element.attachEvent("on"+type,listener)},lib.un=function(element,type,listener){element=lib.g(element),element.addEventListener?element.removeEventListener(type,listener,!1):element.attachEvent&&element.detachEvent("on"+type,listener)},lib.event=event;var painters={};painters.state=function(name){return{name:name,paint:function(control,value){var method=value?"addState":"removeState";control[method](this.name)}}},painters.attribute=function(name,attribute,value){return{name:name,attribute:attribute||name,value:value,paint:function(control,value){var options=null!=this.value&&"object"==typeof this.value?this.value:{defaultValue:this.value};value=null==value?options.defaultValue:value,value=null==value?"":value,options.forceRemove&&value===!1?control.main.removeAttribute(this.attribute):control.main.setAttribute(this.attribute,value)}}};var unitProperties={width:!0,height:!0,top:!0,right:!0,bottom:!0,left:!0,fontSize:!0,padding:!0,paddingTop:!0,paddingRight:!0,paddingBottom:!0,paddingLeft:!0,margin:!0,marginTop:!0,marginRight:!0,marginBottom:!0,marginLeft:!0,borderWidth:!0,borderTopWidth:!0,borderRightWidth:!0,borderBottomWidth:!0,borderLeftWidth:!0};painters.style=function(name,property){return{name:name,property:property||name,paint:function(control,value){null!=value&&(unitProperties.hasOwnProperty(this.property)&&(value=0===value?"0":value+"px"),control.main.style[this.property]=value)}}},painters.html=function(name,element,generate){return{name:name,element:element||"",generate:generate,paint:function(control,value){var element="function"==typeof this.element?this.element(control):this.element?control.helper.getPart(this.element):control.main;if(element){var html="function"==typeof this.generate?this.generate(control,value):value;element.innerHTML=html||""}}}},painters.text=function(name,element,generate){return{name:name,element:element||"",generate:generate,paint:function(control,value){var element="function"==typeof this.element?this.element(control):this.element?control.helper.getPart(this.element):control.main;if(element){var html="function"==typeof this.generate?this.generate(control,value):value;element.innerHTML=u.escape(html||"")}}}},painters.delegate=function(name,member,method){return{name:name,member:this.member,method:this.method,paint:function(control,value){control[this.member][this.method](value)}}},painters.createRepaint=function(){var painters=[].concat.apply([],[].slice.call(arguments));return function(changes,changesIndex){for(var index=lib.extend({},changesIndex),i=0;i<painters.length;i++){var painter=painters[i];if("function"!=typeof painter){var propertyNames=[].concat(painter.name),shouldPaint=!changes;if(!shouldPaint)for(var j=0;j<propertyNames.length;j++){var name=propertyNames[j];if(changesIndex.hasOwnProperty(name)){shouldPaint=!0;break}}if(shouldPaint){for(var properties=[this],j=0;j<propertyNames.length;j++){var name=propertyNames[j];properties.push(this[name]),delete index[name]}try{painter.paint.apply(painter,properties)}catch(ex){var paintingPropertyNames='"'+propertyNames.join('", "')+'"',error=new Error("Failed to paint ["+paintingPropertyNames+'] for control "'+(this.id||"anonymous")+'" of type '+this.type+" because: "+ex.message);throw error.actualError=ex,error}}}else painter.apply(this,arguments)}var unpainted=[];for(var key in index)index.hasOwnProperty(key)&&unpainted.push(index[key]);return unpainted}},ControlCollection.prototype.splice=Array.prototype.splice,ControlCollection.prototype.add=function(control){var index=u.indexOf(this,control);0>index&&[].push.call(this,control)},ControlCollection.prototype.remove=function(control){for(var i=0;i<this.length;i++)if(this[i]===control)return void[].splice.call(this,i,1)},ControlCollection.prototype.each=function(iterator,thisObject){u.each(this,function(control,i){iterator.call(thisObject||control,control,i,this)})},ControlCollection.prototype.invoke=function(methodName){var args=[this];return args.push.apply(args,arguments),u.invoke.apply(u,args)},u.each(["enable","disable","setDisabled","show","hide","toggle","addChild","removeChild","set","setProperties","addState","removeState","toggleState","on","off","fire","dispose","destroy","setViewContext","render","repaint","appendTo","insertBefore"],function(method){ControlCollection.prototype[method]=function(){var args=[method];args.push.apply(args,arguments);var result=this.invoke.apply(this,args);return result&&result[0]}}),u.each(["isDisabled","isHidden","hasState","get","getCategory","getChild","getChildSafely"],function(method){ControlCollection.prototype[method]=function(){var first=this[0];return first?first[method].apply(first,arguments):void 0}}),u.each(["enable","disable","setDisabled","show","hide","toggle","setValue","setRawValue","addChild","removeChild","set","addState","removeState","toggleState","on","off","fire","dispose","destroy","initOptions","createMain","initStructure","setViewContext","render","repaint","appendTo","insertBefore","initChildren","disposeChildren"],function(method){SafeWrapper.prototype[method]=function(){}}),u.each(["isDisabled","isHidden","hasState","isPropertyChanged"],function(method){SafeWrapper.prototype[method]=function(){return!1}}),u.each(["getRawValue","getChild","get"],function(method){SafeWrapper.prototype[method]=function(){return null}}),u.each(["getValue"],function(method){SafeWrapper.prototype[method]=function(){return""}}),u.each(["setProperties"],function(method){SafeWrapper.prototype[method]=function(){return{}}}),SafeWrapper.prototype.getCategory=function(){return"control"},SafeWrapper.prototype.getChildSafely=function(childName){var wrapper=new SafeWrapper;return wrapper.childName=childName,wrapper.parent=this,this.viewContext&&(wrapper.viewContext=this.viewContext),wrapper},lib.inherits(ControlGroup,ControlCollection),ControlGroup.prototype.add=void 0,ControlGroup.prototype.remove=void 0,ControlGroup.prototype.disposeGroup=function(){for(var i=0;i<this.length;i++)delete this[i];this.length=0};var counter=8587523,pool={};ViewContext.get=function(id){return pool[id]||null},ViewContext.prototype.add=function(control){var exists=this.controls[control.id];if(exists){if(exists===control)return;exists.setViewContext(null)}this.controls[control.id]=control;for(var groups=getGroupNames(control),i=0;i<groups.length;i++){var groupName=groups[i];if(groupName){var group=this.getGroup(groupName);addToGroup(control,group)}}control.setViewContext(this)},ViewContext.prototype.remove=function(control){delete this.controls[control.id];for(var groups=getGroupNames(control),i=0;i<groups.length;i++){var groupName=groups[i];if(groupName){var group=this.getGroup(groupName);removeFromGroup(control,group)}}control.setViewContext(null)},ViewContext.prototype.get=function(id){return this.controls[id]},ViewContext.prototype.getControls=function(){return require("./lib").extend({},this.controls)},ViewContext.prototype.getSafely=function(id){var control=this.get(id);return control||(control=new SafeWrapper,control.id=id,control.viewContext=this),control},ViewContext.prototype.getGroup=function(name){if(!name)throw new Error("name is unspecified");var group=this.groups[name];return group||(group=this.groups[name]=new ControlGroup(name)),group},ViewContext.prototype.clean=function(){for(var id in this.controls)if(this.controls.hasOwnProperty(id)){var control=this.controls[id];control.dispose(),control.viewContext&&control.viewContext===this&&this.remove(control)}for(var name in this.groups)this.groups.hasOwnProperty(name)&&(this.groups[name].disposeGroup(),this.groups[name]=void 0)},ViewContext.prototype.dispose=function(){this.clean(),delete pool[this.id]};var main,ui={};main=ui,main.version="3.1.0";var defaultViewContext=new ViewContext("default");main.getViewContext=function(){return defaultViewContext};var config={uiPrefix:"data-ui",extensionPrefix:"data-ui-extension",customElementPrefix:"esui",instanceAttr:"data-ctrl-id",viewContextAttr:"data-ctrl-view-context",uiClassPrefix:"ui",skinClassPrefix:"skin",stateClassPrefix:"state"};main.config=function(info){lib.extend(config,info)},main.getConfig=function(name){return config[name]},main.parseAttribute=function(source,valueReplacer){if(!source)return{};for(var result={},lastStop=0,cursor=0;cursor<source.length;){for(;cursor<source.length&&":"!==source.charAt(cursor);)cursor++;if(cursor>=source.length)break;var key=lib.trim(source.slice(lastStop,cursor));for(cursor++,lastStop=cursor;cursor<source.length&&";"!==source.charAt(cursor);)cursor++;for(var lookAheadIndex=cursor+1;lookAheadIndex<source.length;){var ch=source.charAt(lookAheadIndex);if(";"===ch&&(cursor=lookAheadIndex),":"===ch)break;lookAheadIndex++}var value=lib.trim(source.slice(lastStop,cursor));result[key]=valueReplacer?valueReplacer(value):value,cursor++,lastStop=cursor}return result},main.getControlByDOM=function(dom){if(!dom)return null;var viewContext,getConf=main.getConfig,controlId=dom.getAttribute(getConf("instanceAttr")),viewContextId=dom.getAttribute(getConf("viewContextAttr"));return controlId&&viewContextId&&(viewContext=ViewContext.get(viewContextId))?viewContext.get(controlId):null};var controlClasses={};main.register=function(controlClass){registerClass(controlClass,controlClasses)},main.create=function(type,options){return createInstance(type,options,controlClasses)},main.get=function(id){return defaultViewContext.get(id)},main.getSafely=function(id){return defaultViewContext.getSafely(id)},main.wrap=function(){for(var collection=new ControlCollection,i=0;i<arguments.length;i++)collection.add(arguments[i]);return collection},main.init=function(wrap,options){function joinCamelCase(source){function replacer(c){return c.toUpperCase()}for(var i=1,len=source.length;len>i;i++)source[i]=source[i].replace(/^[a-z]/,replacer);return source.join("")}function noOverrideExtend(target,source){for(var key in source)key in target||(target[key]=source[key])}function extendToOption(optionObject,terms,value){0===terms.length?noOverrideExtend(optionObject,main.parseAttribute(value,valueReplacer)):optionObject[joinCamelCase(terms)]=valueReplacer(value)}wrap=wrap||document.body,options=options||{};for(var valueReplacer=options.valueReplacer||function(value){return value},rawElements=wrap.getElementsByTagName("*"),elements=[],i=0,len=rawElements.length;len>i;i++)1===rawElements[i].nodeType&&elements.push(rawElements[i]);for(var uiPrefix=main.getConfig("uiPrefix"),extPrefix=main.getConfig("extensionPrefix"),customElementPrefix=main.getConfig("customElementPrefix"),uiPrefixLen=uiPrefix.length,extPrefixLen=extPrefix.length,properties=options.properties||{},controls=[],i=0,len=elements.length;len>i;i++){var element=elements[i];if(!element.getAttribute(config.instanceAttr)){for(var attributes=element.attributes,controlOptions={},extensionOptions={},j=0,attrLen=attributes.length;attrLen>j;j++){var attribute=attributes[j],name=attribute.name,value=attribute.value;if(0===name.indexOf(extPrefix)){var terms=name.slice(extPrefixLen+1).split("-"),extKey=terms[0];terms.shift();var extOption=extensionOptions[extKey];extOption||(extOption=extensionOptions[extKey]={}),extendToOption(extOption,terms,value)}else if(0===name.indexOf(uiPrefix)){var terms=name.length===uiPrefixLen?[]:name.slice(uiPrefixLen+1).split("-");extendToOption(controlOptions,terms,value)}}var type=controlOptions.type;if(!type){var nodeName=element.nodeName.toLowerCase(),esuiPrefixIndex=nodeName.indexOf(customElementPrefix);if(0===esuiPrefixIndex){var typeFromCustomElement;typeFromCustomElement=nodeName.replace(/-(\S)/g,function(match,ch){return ch.toUpperCase()}),typeFromCustomElement=typeFromCustomElement.slice(customElementPrefix.length),controlOptions.type=typeFromCustomElement,type=typeFromCustomElement}}if(type){var controlId=controlOptions.id,customOptions=controlId?properties[controlId]:{};for(var key in customOptions)controlOptions[key]=valueReplacer(customOptions[key]);var extensions=controlOptions.extensions||[];controlOptions.extensions=extensions;for(var key in extensionOptions){var extOption=extensionOptions[key],extension=main.createExtension(extOption.type,extOption);extension&&extensions.push(extension)}controlOptions.viewContext=options.viewContext,controlOptions.renderOptions=options,controlOptions.main=element;var control=main.create(type,controlOptions);if(control){controls.push(control),options.parent&&options.parent.addChild(control);try{control.render()}catch(ex){var error=new Error('Render control "'+(control.id||"anonymous")+'" of type '+control.type+" failed because: "+ex.message);throw error.actualError=ex,error}}}}}return controls};var extensionClasses={};main.registerExtension=function(extensionClass){registerClass(extensionClass,extensionClasses)},main.createExtension=function(type,options){return createInstance(type,options,extensionClasses)};var globalExtensionOptions={};main.attachExtension=function(type,options){globalExtensionOptions[type]=options},main.createGlobalExtensions=function(){var extensions=[];for(var type in globalExtensionOptions)if(globalExtensionOptions.hasOwnProperty(type)){var extension=main.createExtension(type,globalExtensionOptions[type]);extension&&extensions.push(extension)}return extensions};var ruleClasses=[];main.registerRule=function(ruleClass,priority){ruleClasses.push({type:ruleClass,priority:priority}),ruleClasses.sort(function(x,y){return x.priority-y.priority})},main.createRulesByControl=function(control){for(var rules=[],i=0;i<ruleClasses.length;i++){var RuleClass=ruleClasses[i].type;null!=control.get(RuleClass.prototype.type)&&rules.push(new RuleClass)}return rules},Rule.prototype.type=null,Rule.prototype.errorMessage="${title}验证失败",Rule.prototype.check=function(value,control){var ValidityState=require("./ValidityState");return new ValidityState(!0,"")},Rule.prototype.getErrorMessage=function(control){var lib=require("../lib"),errorMessage=control.get(this.type+"ErrorMessage")||this.errorMessage;return lib.format(errorMessage,control)},Rule.prototype.getLimitCondition=function(control){return control.get(this.type)},Rule.prototype.getName=function(){return this.type},Validity.prototype.addState=function(name,state){if(this.stateIndex[name]){if(this.stateIndex[name]===state)return;for(var i=0;i<this.states.length;i++)if(this.states[i]===this.stateIndex[name]){this.states.splice(i,1);break}}this.states.push(state),this.stateIndex[name]=state},Validity.prototype.getState=function(name){return this.stateIndex[name]||null},Validity.prototype.getStates=function(){return this.states.slice()},Validity.prototype.getCustomMessage=function(){return this.customMessage},Validity.prototype.setCustomMessage=function(message){this.customMessage=message},Validity.prototype.setCustomValidState=function(validState){this.customValidState=validState},Validity.prototype.isValid=function(){return u.every(this.getStates(),function(state){return state.getState()})},Validity.prototype.getValidState=function(){return this.customValidState||(this.isValid()?"valid":"invalid")},ValidityState.prototype.getMessage=function(){return this.message},ValidityState.prototype.getState=function(){return this.state},ValidityState.prototype.setMessage=function(message){this.message=message},ValidityState.prototype.setState=function(state){this.state=state},RequiredRule.prototype.type="required",RequiredRule.prototype.errorMessage="${title}不能为空",RequiredRule.prototype.check=function(value,control){return new ValidityState(!!value,this.getErrorMessage(control))},lib.inherits(RequiredRule,Rule),main.registerRule(RequiredRule,0),PatternRule.prototype.type="pattern",PatternRule.prototype.errorMessage="${title}格式不符合要求",PatternRule.prototype.check=function(value,control){var regex=new RegExp(this.getLimitCondition(control));return new ValidityState(!value||regex.test(value),this.getErrorMessage(control))},lib.inherits(PatternRule,Rule),main.registerRule(PatternRule,200),MinRule.prototype.type="min",MinRule.prototype.errorMessage="${title}不能小于${min}",MinRule.prototype.check=function(value,control){var valueOfNumber=+value,isValidNumber=!isNaN(valueOfNumber)&&valueOfNumber>=this.getLimitCondition(control);return new ValidityState(!value||isValidNumber,this.getErrorMessage(control))},lib.inherits(MinRule,Rule),main.registerRule(MinRule,300),MinLengthRule.prototype.type="minLength",MinLengthRule.prototype.errorMessage="${title}不能小于${minLength}个字符",MinLengthRule.prototype.check=function(value,control){return new ValidityState(value.length>=this.getLimitCondition(control),this.getErrorMessage(control))},lib.inherits(MinLengthRule,Rule),main.registerRule(MinLengthRule,100),MinByteLengthRule.prototype.type="minByteLength",MinByteLengthRule.prototype.errorMessage="${title}不能小于${minByteLength}个字符",MinByteLengthRule.prototype.check=function(value,control){var byteLength=value.replace(/[^\x00-\xff]/g,"xx").length;return new ValidityState(byteLength>=this.getLimitCondition(control),this.getErrorMessage(control))},lib.inherits(MinByteLengthRule,Rule),main.registerRule(MinByteLengthRule,100),MaxRule.prototype.type="max",MaxRule.prototype.errorMessage="${title}不能大于${max}",MaxRule.prototype.check=function(value,control){var valueOfNumber=+value,isValidNumber=!isNaN(valueOfNumber)&&valueOfNumber<=this.getLimitCondition(control);return new ValidityState(!value||isValidNumber,this.getErrorMessage(control))},lib.inherits(MaxRule,Rule),main.registerRule(MaxRule,301),MaxLengthRule.prototype.type="maxLength",MaxLengthRule.prototype.errorMessage="${title}不能超过${maxLength}个字符",MaxLengthRule.prototype.check=function(value,control){return new ValidityState(value.length<=this.getLimitCondition(control),this.getErrorMessage(control))},MaxLengthRule.prototype.getErrorMessage=function(control){var lib=require("../lib"),errorMessage=control.get(this.type+"ErrorMessage")||this.errorMessage,maxLength=this.getLimitCondition(control),data={title:control.get("title"),maxLength:maxLength,length:maxLength};return lib.format(errorMessage,data)},MaxLengthRule.prototype.getLimitCondition=function(control){return control.get("length")||control.get("maxLength")},lib.inherits(MaxLengthRule,Rule),main.registerRule(MaxLengthRule,100),MaxByteLengthRule.prototype.type="maxByteLength",MaxByteLengthRule.prototype.errorMessage="${title}不能超过${maxByteLength}个字符",MaxByteLengthRule.prototype.check=function(value,control){var byteLength=value.replace(/[^\x00-\xff]/g,"xx").length;return new ValidityState(byteLength<=this.getLimitCondition(control),this.getErrorMessage(control))},lib.inherits(MaxByteLengthRule,Rule),main.registerRule(MaxByteLengthRule,100);var helper={};helper.getPartClasses=function(part){if(part&&this.partClassCache&&this.partClassCache.hasOwnProperty(part))return this.partClassCache[part].slice();var type=getControlClassType(this.control),skin=this.control.skin,prefix=ui.getConfig("uiClassPrefix"),skinPrefix=ui.getConfig("skinClassPrefix"),classes=[];return part?(classes.push(joinByStrike(prefix,type,part)),skin&&classes.push(joinByStrike(skinPrefix,skin,type,part)),this.partClassCache||(this.partClassCache={},this.partClassCache[part]=classes.slice())):(classes.push(joinByStrike(prefix,"ctrl")),classes.push(joinByStrike(prefix,type)),skin&&classes.push(joinByStrike(skinPrefix,skin),joinByStrike(skinPrefix,skin,type))),classes},helper.getPartClassName=function(part){return this.getPartClasses(part).join(" ")},helper.getPrimaryClassName=function(part){var type=getControlClassType(this.control);return part?joinByStrike(ui.getConfig("uiClassPrefix"),type,part):joinByStrike(ui.getConfig("uiClassPrefix"),type)},helper.addPartClasses=function(part,element){"string"==typeof element&&(element=this.getPart(element)),element=element||this.control.main,element&&lib.addClasses(element,this.getPartClasses(part))},helper.removePartClasses=function(part,element){"string"==typeof element&&(element=this.getPart(element)),element=element||this.control.main,element&&lib.removeClasses(element,this.getPartClasses(part))},helper.getStateClasses=function(state){if(this.stateClassCache&&this.stateClassCache.hasOwnProperty(state))return this.stateClassCache[state].slice();var type=getControlClassType(this.control),getConf=ui.getConfig,classes=[joinByStrike(getConf("uiClassPrefix"),type,state),joinByStrike(getConf("stateClassPrefix"),state)],skin=this.control.skin;if(skin){var skinPrefix=getConf("skinClassPrefix");classes.push(joinByStrike(skinPrefix,skin,state),joinByStrike(skinPrefix,skin,type,state))}return this.stateClassCache||(this.stateClassCache={},this.stateClassCache[state]=classes.slice()),classes},helper.addStateClasses=function(state){var element=this.control.main;element&&lib.addClasses(element,this.getStateClasses(state))},helper.removeStateClasses=function(state){var element=this.control.main;element&&lib.removeClasses(element,this.getStateClasses(state))},helper.getId=function(part){part=part?"-"+part:"",this.control.domIDPrefix||(this.control.domIDPrefix=this.control.viewContext&&this.control.viewContext.id);var prefix=this.control.domIDPrefix?this.control.domIDPrefix+"-":"";return"ctrl-"+prefix+this.control.id+part},helper.createPart=function(part,nodeName){nodeName=nodeName||"div";var element=document.createElement(nodeName);return element.id=this.getId(part),this.addPartClasses(part,element),element},helper.getPart=function(part){return lib.g(this.getId(part))},helper.isPart=function(element,part){var className=this.getPartClasses(part)[0];return lib.hasClass(element,className)};var INPUT_SPECIFIED_ATTRIBUTES={type:!0,name:!0,alt:!0,autocomplete:!0,autofocus:!0,checked:!0,dirname:!0,disabled:!0,form:!0,formaction:!0,formenctype:!0,formmethod:!0,formnovalidate:!0,formtarget:!0,width:!0,height:!0,inputmode:!0,list:!0,max:!0,maxlength:!0,min:!0,minlength:!0,multiple:!0,pattern:!0,placeholder:!0,readonly:!0,required:!0,size:!0,src:!0,step:!0,value:!0};helper.replaceMain=function(main){main=main||this.control.createMain();var initialMain=this.control.main;initialMain.setAttribute(ui.getConfig("instanceAttr"),lib.getGUID());for(var attributes=initialMain.attributes,i=0;i<attributes.length;i++){var attribute=attributes[i],name=attribute.name;lib.hasAttribute(initialMain,name)&&!INPUT_SPECIFIED_ATTRIBUTES.hasOwnProperty(name)&&(lib.setAttribute(main,name,attribute.value),0===name.indexOf(ui.getConfig("uiPrefix"))&&(initialMain.removeAttribute(name),i--))}return lib.insertBefore(main,initialMain),initialMain.parentNode.removeChild(initialMain),this.control.main=main,initialMain};var INPUT_PROPERTY_MAPPING={name:{name:"name"},maxlength:{name:"maxLength",type:"number"},required:{name:"required",type:"boolean"},pattern:{name:"pattern"},min:{name:"min",type:"number"},max:{name:"max",type:"number"},autofocus:{name:"autoFocus",type:"boolean"},disabled:{name:"disabled",type:"boolean"},readonly:{name:"readOnly",type:"boolean"}};helper.extractOptionsFromInput=function(input,options){var result={};return u.each(INPUT_PROPERTY_MAPPING,function(config,attributeName){var specified=lib.hasAttribute(input,attributeName);if(specified){var value=lib.getAttribute(input,attributeName);switch(config.type){case"boolean":value=specified;break;case"number":value=parseInt(value,10)}result[config.name]=value}}),(lib.hasAttribute(input,"value")||"select"!==input.nodeName.toLowerCase()&&input.value)&&(result.value=input.value),u.defaults(options||{},result)},helper.initChildren=function(wrap,options){wrap=wrap||this.control.main,options=u.extend({},this.control.renderOptions,options),options.viewContext=this.control.viewContext,options.parent=this.control,ui.init(wrap,options)},helper.disposeChildren=function(){var children=this.control.children.slice();u.each(children,function(child){child.dispose()}),this.children=[],this.childrenIndex={}},helper.disableChildren=function(){u.each(this.control.children,function(child){child.disable()})},helper.enableChildren=function(){u.each(this.control.children,function(child){child.enable()})};var DOM_EVENTS_KEY="_esuiDOMEvent",globalEvents={window:{},document:{},documentElement:{},body:{}};helper.addDOMEvent=function(element,type,handler){"string"==typeof element&&(element=this.getPart(element)),this.control.domEvents||(this.control.domEvents={});var guid=element[DOM_EVENTS_KEY];guid||(guid=element[DOM_EVENTS_KEY]=lib.getGUID());var events=this.control.domEvents[guid];events||(events=this.control.domEvents[guid]={element:element});var isGlobal=addGlobalDOMEvent(this.control,type,element),queue=events[type];queue||(queue=events[type]=new EventQueue,isGlobal||(queue.handler=u.partial(triggerDOMEvent,this.control,element),lib.on(element,type,queue.handler))),queue.add(handler)},helper.delegateDOMEvent=function(element,type,newType){var handler=function(e){var event=require("mini-event").fromDOMEvent(e);this.fire(newType||e.type,event),event.isDefaultPrevented()&&lib.event.preventDefault(e),event.isPropagationStopped()&&lib.event.stopPropagation(e)};this.addDOMEvent(element,type,handler)},helper.removeDOMEvent=function(element,type,handler){if("string"==typeof element&&(element=this.getPart(element)),this.control.domEvents){var guid=element[DOM_EVENTS_KEY],events=this.control.domEvents[guid];if(events&&events[type])if(handler){var queue=events[type];queue.remove(handler),queue.getLength()||removeGlobalDOMEvent(this.control,type,element)}else events[type].clear()}},helper.clearDOMEvents=function(element){if("string"==typeof element&&(element=this.getPart(element)),this.control.domEvents){if(!element)return u.each(u.map(this.control.domEvents,"element"),this.clearDOMEvents,this),void(this.control.domEvents=null);var guid=element[DOM_EVENTS_KEY],events=this.control.domEvents[guid];delete events.element,u.each(events,function(queue,type){var isGlobal=removeGlobalDOMEvent(this.control,type,element);if(!isGlobal){var handler=queue.handler;queue.dispose(),queue.handler=null,lib.un(element,type,handler)}},this),delete this.control.domEvents[guid]}};var SELF_CLOSING_TAGS={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};helper.getPartBeginTag=function(part,nodeName){var html="<"+nodeName+' id="'+this.getId(part)+'" class="'+this.getPartClassName(part)+'">';return html},helper.getPartEndTag=function(part,nodeName){var html=SELF_CLOSING_TAGS.hasOwnProperty(nodeName)?" />":"</"+nodeName+">";return html},helper.getPartHTML=function(part,nodeName){return this.getPartBeginTag(part,nodeName)+this.getPartEndTag(part,nodeName)};var LifeCycle={NEW:0,
INITED:1,RENDERED:2,DISPOSED:4};helper.initViewContext=function(){var viewContext=this.control.viewContext||ui.getViewContext();this.control.viewContext=null,this.control.setViewContext(viewContext)},helper.initExtensions=function(){var extensions=this.control.extensions;u.isArray(extensions)||(extensions=this.control.extensions=[]),Array.prototype.push.apply(extensions,ui.createGlobalExtensions());for(var registeredExtensions={},i=0;i<extensions.length;i++){var extension=extensions[i];registeredExtensions[extension.type]||(extension.attachTo(this.control),registeredExtensions[extension.type]=!0)}},helper.isInStage=function(stage){if(null==LifeCycle[stage])throw new Error("Invalid life cycle stage: "+stage);return this.control.stage===LifeCycle[stage]},helper.changeStage=function(stage){if(null==LifeCycle[stage])throw new Error("Invalid life cycle stage: "+stage);this.control.stage=LifeCycle[stage]},helper.dispose=function(){this.control.disposeChildren(),this.control.children=null,this.control.childrenIndex=null,this.clearDOMEvents(),u.invoke(this.control.extensions,"dispose"),this.control.extensions=null,this.control.parent&&this.control.parent.removeChild(this.control),this.control.viewContext&&this.control.viewContext.remove(this.control),this.control.renderOptions=null},helper.beforeDispose=function(){this.control.fire("beforedispose")},helper.afterDispose=function(){this.changeStage("DISPOSED"),this.control.fire("afterdispose"),this.control.destroyEvents()};var FILTERS={id:function(part,instance){return instance.helper.getId(part)},"class":function(part,instance){return instance.helper.getPartClassName(part)},part:function(part,nodeName,instance){return instance.helper.getPartHTML(part,nodeName)}};helper.setTemplateEngine=function(engine){this.templateEngine=engine,engine.esui||this.initializeTemplateEngineExtension()},helper.initializeTemplateEngineExtension=function(){u.each(FILTERS,function(filter,name){this.addFilter(name,filter)},this.templateEngine)},helper.renderTemplate=function(target,data){var helper=this;data=data||{};var templateData={get:function(name){if("instance"===name)return helper.control;if("function"==typeof data.get)return data.get(name);var propertyName=name,filter=null,indexOfDot=name.lastIndexOf(".");if(indexOfDot>0){propertyName=name.substring(0,indexOfDot);var filterName=name.substring(indexOfDot+1);filterName&&FILTERS.hasOwnProperty(filterName)&&(filter=FILTERS[filterName])}var value=data.hasOwnProperty(propertyName)?data[propertyName]:propertyName;return filter&&(value=filter(value,helper.control)),value}};if(!this.templateEngine)throw new Error("No template engine attached to this control");return this.templateEngine.render(target,templateData)},u.extend(Helper.prototype,helper),Layer.prototype.nodeName="div",Layer.prototype.autoHide=!0,Layer.prototype.enableAutoHide=function(element){var eventName="onwheel"in document.body?"wheel":"mousewheel";this.control.helper.addDOMEvent(document.documentElement,eventName,u.bind(this.hide,this)),this.control.helper.addDOMEvent(element,eventName,function(e){e.stopPropagation()})},Layer.prototype.create=function(){var element=this.control.helper.createPart("layer",this.nodeName);return lib.addClass(element,ui.getConfig("uiClassPrefix")+"-layer"),this.autoHide&&this.enableAutoHide(element),element},Layer.prototype.addCustomClasses=function(layerClassNames){var element=this.getElement();lib.addClasses(element,layerClassNames)},Layer.prototype.render=function(element){},Layer.prototype.syncState=function(element){},Layer.prototype.repaint=function(){var element=this.getElement(!1);element&&this.render(element)},Layer.prototype.initBehavior=function(element){},Layer.prototype.getElement=function(create){var element=this.control.helper.getPart("layer");return element||create===!1||(element=this.create(),this.render(element),lib.addClasses(element,getHiddenClasses(this)),this.initBehavior(element),this.control.helper.addDOMEvent(document,"mousedown",u.bind(close,this)),this.control.helper.addDOMEvent(element,"mousedown",function(e){e.stopPropagation()}),this.syncState(element),element.parentElement||document.body.appendChild(element),this.fire("rendered")),element},Layer.prototype.hide=function(){var classes=getHiddenClasses(this),element=this.getElement();lib.addClasses(element,classes),this.control.removeState("active"),this.fire("hide")},Layer.prototype.show=function(){var element=this.getElement();element.style.zIndex=this.getZIndex(),this.position();var classes=getHiddenClasses(this);lib.removeClasses(element,classes),this.control.addState("active"),this.fire("show")},Layer.prototype.toggle=function(){var element=this.getElement();!element||this.control.helper.isPart(element,"layer-hidden")?this.show():this.hide()},Layer.prototype.position=function(){var element=this.getElement();Layer.attachTo(element,this.control.main,this.dock)},Layer.prototype.getZIndex=function(){return Layer.getZIndex(this.control.main)},Layer.prototype.dispose=function(){var element=this.getElement(!1);element&&(element.innerHTML="",lib.removeNode(element)),this.control=null};var zIndexStack=1e3;Layer.create=function(tagName){var element=document.createElement(tagName||"div");return element.style.position="absolute",element},Layer.getZIndex=function(owner){for(var zIndex=0;!zIndex&&owner&&owner!==document;)zIndex=parseInt(lib.getComputedStyle(owner,"zIndex"),10),owner=owner.parentNode;return zIndex=zIndex||0,zIndex+1},Layer.moveToTop=function(element){element.style.zIndex=++zIndexStack},Layer.moveTo=function(element,top,left){positionLayerElement(element,{top:top,left:left})},Layer.resize=function(element,width,height){positionLayerElement(element,{width:width,height:height})},Layer.attachTo=function(layer,target,options){options=options||{strictWidth:!1};var pageWidth=lib.page.getViewWidth(),pageHeight=lib.page.getViewHeight(),pageScrollTop=lib.page.getScrollTop(),pageScrollLeft=lib.page.getScrollLeft(),targetOffset=lib.getOffset(target),previousDisplayValue=layer.style.display;layer.style.display="block",layer.style.top="-5000px",layer.style.left="-5000px",options.strictWidth&&(layer.style.minWidth=targetOffset.width+"px");var layerOffset=lib.getOffset(layer);layer.style.top="",layer.style.left="",layer.style.display=previousDisplayValue;var properties={},bottomSpace=pageHeight-(targetOffset.bottom-pageScrollTop),topSpace=targetOffset.top-pageScrollTop;bottomSpace<=layerOffset.height&&topSpace>layerOffset.height?properties.top=targetOffset.top-layerOffset.height:properties.top=targetOffset.bottom;var rightSpace=pageWidth-(targetOffset.left-pageScrollLeft),leftSpace=targetOffset.right-pageScrollLeft;rightSpace<=layerOffset.width&&leftSpace>layerOffset.width?properties.left=targetOffset.right-layerOffset.width:properties.left=targetOffset.left,positionLayerElement(layer,properties)},Layer.centerToView=function(element,options){var properties=options?lib.clone(options):{};"number"!=typeof properties.width&&(properties.width=this.width),"number"!=typeof properties.height&&(properties.height=this.height),properties.left=(lib.page.getViewWidth()-properties.width)/2;var viewHeight=lib.page.getViewHeight();properties.height>=viewHeight&&options.hasOwnProperty("minTop")?properties.top=options.minTop:properties.top=Math.floor((viewHeight-properties.height)/2);var viewWidth=lib.page.getViewWidth();properties.height>=viewWidth&&options.hasOwnProperty("minLeft")?properties.left=options.minLeft:properties.left=Math.floor((viewWidth-properties.width)/2),properties.top+=lib.page.getScrollTop(),this.setProperties(properties)},lib.inherits(Layer,EventTarget),helper.getGUID=lib.getGUID;var methods=["initViewContext","initExtensions","isInStage","changeStage","dispose","beforeDispose","afterDispose","getPartClasses","addPartClasses","removePartClasses","getStateClasses","addStateClasses","removeStateClasses","getId","replaceMain","addDOMEvent","removeDOMEvent","clearDOMEvents"];helper.createRepaint=painters.createRepaint,u.each(methods,function(name){helper[name]=function(control){var helper=control.helper||new Helper(control),args=[].slice.call(arguments,1);return helper[name].apply(helper,args)}}),helper.extractValueFromInput=function(control,options){var main=control.main;lib.isInput(main)&&(main.value&&!options.value&&(options.value=main.value),main.name&&!options.name&&(options.name=main.name),!main.disabled||null!==options.disabled&&void 0!==options.disabled||(options.disabled=main.disabled),!main.readOnly||null!==options.readOnly&&void 0!==options.readOnly||(options.readOnly=main.readonly||main.readOnly))};var layer=helper.layer={};layer.create=Layer.create,layer.getZIndex=Layer.getZIndex,layer.moveToTop=Layer.moveToTop,layer.moveTo=Layer.moveTo,layer.resize=Layer.resize,layer.attachTo=Layer.attachTo,layer.centerToView=Layer.centerToView,Control.prototype={constructor:Control,ignoreStates:["disabled"],getCategory:function(){return"control"},initOptions:function(options){options=options||{},this.setProperties(options)},createMain:function(){if(!this.type)return document.createElement("div");var name=this.type.replace(/([A-Z])/g,function(match,ch){return"-"+ch.toLowerCase()});return document.createElement(ui.getConfig("customElementPrefix")+"-"+name.slice(1))},initStructure:function(){},initEvents:function(){},render:function(){this.helper.isInStage("INITED")&&(this.fire("beforerender"),this.domIDPrefix=this.viewContext.id,this.initStructure(),this.initEvents(),this.main.id||(this.main.id=this.helper.getId()),this.main.setAttribute(ui.getConfig("instanceAttr"),this.id),this.main.setAttribute(ui.getConfig("viewContextAttr"),this.viewContext.id),this.helper.addPartClasses(),this.states&&(this.states="string"==typeof this.states?this.states.split(" "):this.states,u.each(this.states,this.addState,this))),this.repaint(),this.helper.isInStage("INITED")&&(this.helper.changeStage("RENDERED"),this.fire("afterrender"))},repaint:function(changes,changesIndex){if(!changesIndex||changesIndex.hasOwnProperty("disabled")){var method=this.disabled?"addState":"removeState";this[method]("disabled")}if(!changesIndex||changesIndex.hasOwnProperty("hidden")){var method=this.hidden?"addState":"removeState";this[method]("hidden")}},appendTo:function(wrap){wrap instanceof Control&&(wrap=wrap.main),wrap.appendChild(this.main),(this.helper.isInStage("NEW")||this.helper.isInStage("INITED"))&&this.render()},insertBefore:function(reference){reference instanceof Control&&(reference=reference.main),reference.parentNode.insertBefore(this.main,reference),(this.helper.isInStage("NEW")||this.helper.isInStage("INITED"))&&this.render()},dispose:function(){this.helper.isInStage("DISPOSED")||(this.helper.beforeDispose(),this.helper.dispose(),this.helper.afterDispose())},destroy:function(){var main=this.main;this.dispose(),lib.removeNode(main)},get:function(name){var method=this["get"+lib.pascalize(name)];return"function"==typeof method?method.call(this):this[name]},set:function(name,value){var method=this["set"+lib.pascalize(name)];if("function"==typeof method)return method.call(this,value);var property={};property[name]=value,this.setProperties(property)},isPropertyChanged:function(propertyName,newValue,oldValue){return oldValue!==newValue},setProperties:function(properties){this.stage||(properties.hasOwnProperty("id")&&(this.id=properties.id),properties.hasOwnProperty("group")&&(this.group=properties.group),properties.hasOwnProperty("skin")&&(this.skin=properties.skin)),delete properties.id,delete properties.group,delete properties.skin,properties.hasOwnProperty("viewContext")&&(this.setViewContext(properties.viewContext),delete properties.viewContext),this.hasOwnProperty("disabled")&&(this.disabled=!!this.disabled),this.hasOwnProperty("hidden")&&(this.hidden=!!this.hidden);var changes=[],changesIndex={};for(var key in properties)if(properties.hasOwnProperty(key)){var newValue=properties[key],getterMethodName="get"+lib.pascalize(key)+"Property",oldValue=this[getterMethodName]?this[getterMethodName]():this[key],isChanged=this.isPropertyChanged(key,newValue,oldValue);if(isChanged){this[key]=newValue;var record={name:key,oldValue:oldValue,newValue:newValue};changes.push(record),changesIndex[key]=record}}return changes.length&&this.helper.isInStage("RENDERED")&&this.repaint(changes,changesIndex),changesIndex},setViewContext:function(viewContext){var oldViewContext=this.viewContext;if(oldViewContext!==viewContext){oldViewContext&&(this.viewContext=null,oldViewContext.remove(this)),this.viewContext=viewContext,viewContext&&viewContext.add(this);var children=this.children;if(children)for(var i=0,len=children.length;len>i;i++)children[i].setViewContext(viewContext);this.viewContext&&this.helper.isInStage("RENDERED")&&this.main.setAttribute(ui.getConfig("viewContextAttr"),this.viewContext.id)}},setDisabled:function(disabled){this[disabled?"disable":"enable"]()},disable:function(){this.addState("disabled")},enable:function(){this.removeState("disabled")},isDisabled:function(){return this.hasState("disabled")},show:function(){this.removeState("hidden")},hide:function(){this.addState("hidden")},toggle:function(){this[this.isHidden()?"show":"hide"]()},isHidden:function(){return this.hasState("hidden")},addState:function(state){if(!this.hasState(state)){this.currentStates[state]=!0,this.helper.addStateClasses(state);var properties={},statePropertyName=state.replace(/-(\w)/,function(m,c){return c.toUpperCase()});properties[statePropertyName]=!0,this.setProperties(properties)}},removeState:function(state){if(this.hasState(state)){this.currentStates[state]=!1,this.helper.removeStateClasses(state);var properties={},statePropertyName=state.replace(/-(\w)/,function(m,c){return c.toUpperCase()});properties[statePropertyName]=!1,this.setProperties(properties)}},toggleState:function(state){var methodName=this.hasState(state)?"removeState":"addState";this[methodName](state)},hasState:function(state){return!!this.currentStates[state]},addChild:function(control,childName){childName=childName||control.childName,control.parent&&control.parent.removeChild(control),this.children.push(control),control.parent=this,childName&&(control.childName=childName,this.childrenIndex[childName]=control),this.viewContext!==control.viewContext&&control.setViewContext(this.viewContext)},removeChild:function(control){for(var children=this.children,len=children.length;len--;)children[len]===control&&children.splice(len,1);var childName=control.childName;childName&&(this.childrenIndex[childName]=null),control.parent=null},disposeChildren:function(){for(var children=this.children.slice(),i=0;i<children.length;i++)children[i].dispose();this.children=[],this.childrenIndex={}},getChild:function(childName){return this.childrenIndex[childName]||null},getChildSafely:function(childName){var child=this.getChild(childName);return child||(child=new SafeWrapper,child.childName=childName,child.parent=this,this.viewContext&&(child.viewContext=this.viewContext)),child},initChildren:function(wrap,options){this.helper.initChildren(wrap,options)}},lib.inherits(Control,EventTarget),ValidityLabel.prototype.type="ValidityLabel",ValidityLabel.prototype.createMain=function(){return document.createElement("label")},ValidityLabel.prototype.initOptions=function(options){var properties=u.extend({},ValidityLabel.defaultProperties,options);Control.prototype.initOptions.call(this,properties)},ValidityLabel.prototype.display=function(validState,message,validity){this.main.innerHTML=message},ValidityLabel.prototype.repaint=painters.createRepaint(Control.prototype.repaint,{name:["target","targetType"],paint:function(label){var validState=label.validity?label.validity.getValidState():"",classes=getClasses(label,validState);label.main.className=classes.join(" ")}},{name:"focusTarget",paint:function(label,focusTarget){"label"===label.main.nodeName.toLowerCase()&&(focusTarget&&focusTarget.id?lib.setAttribute(label.main,"for",focusTarget.id):lib.removeAttribute(label.main,"for"))}},{name:"validity",paint:function(label,validity){var validState=validity&&validity.getValidState(),classes=getClasses(label,validState);if(label.main.className=classes.join(" "),label.disposeChildren(),validity){var message=validity.getCustomMessage();if(!message){var invalidState=u.find(validity.getStates(),function(state){return!state.getState()});message=invalidState&&invalidState.getMessage()}label.display(validState,message||"",validity),label.helper.initChildren(),message?label.show():label.hide()}else label.main.innerHTML="",label.hide()}}),ValidityLabel.prototype.dispose=function(){this.helper.isInStage("DISPOSED")||(this.target&&(this.target.validityLabel=null,this.target=null),this.focusTarget=null,this.main.parentNode&&this.main.parentNode.removeChild(this.main),Control.prototype.dispose.apply(this,arguments))},lib.inherits(ValidityLabel,Control),main.register(ValidityLabel),InputControl.prototype={constructor:InputControl,ignoreStates:Control.prototype.ignoreStates.concat("read-only"),getCategory:function(){return"input"},getFocusTarget:function(){return null},getValue:function(){return this.stringifyValue(this.getRawValue())},setValue:function(value){var rawValue=this.parseValue(value);this.setRawValue(rawValue)},getRawValue:function(){return this.rawValue},setRawValue:function(rawValue){this.setProperties({rawValue:rawValue})},setProperties:function(properties){var value=properties.value;return delete properties.value,null!=value&&null==properties.rawValue&&(properties.rawValue=this.parseValue(value)),this.hasOwnProperty("readOnly")&&(this.readOnly=!!this.readOnly),Control.prototype.setProperties.call(this,properties)},repaint:helper.createRepaint(Control.prototype.repaint,{name:"disabled",paint:function(control,value){var nodeName=control.main.nodeName.toLowerCase();"input"!==nodeName&&"select"!==nodeName&&"textarea"!==nodeName||(control.main.disabled=value)}},{name:"readOnly",paint:function(control,value){var method=value?"addState":"removeState";control[method]("read-only");var nodeName=control.main.nodeName.toLowerCase();"input"!==nodeName&&"select"!==nodeName&&"textarea"!==nodeName||(control.main.readOnly=value)}},{name:"hidden",paint:function(control,hidden){var validityLabel=control.getValidityLabel(!0);if(validityLabel){var classPrefix=main.getConfig("uiClassPrefix"),classes=[].concat(classPrefix+"-hidden",classPrefix+"-validity-hidden",helper.getPartClasses(control,"validity-hidden")),method=control.isHidden()?"addClasses":"removeClasses";lib[method](validityLabel,classes)}}}),stringifyValue:function(rawValue){return null!=rawValue?rawValue+"":""},parseValue:function(value){return value},setReadOnly:function(readOnly){readOnly=!!readOnly,this[readOnly?"addState":"removeState"]("read-only")},isReadOnly:function(){return this.hasState("read-only")},getValidationResult:function(){var validity=new Validity,eventArg={validity:validity};eventArg=this.fire("beforevalidate",eventArg);for(var rules=main.createRulesByControl(this),i=0,len=rules.length;len>i;i++){var rule=rules[i];validity.addState(rule.getName(),rule.check(this.getValue(),this))}return validity.isValid()||(eventArg=this.fire("invalid",eventArg)),this.fire("aftervalidate",eventArg),validity},checkValidity:function(){var validity=this.getValidationResult();return validity.isValid()},validate:function(){var validity=this.getValidationResult();return this.showValidity(validity),validity.isValid()},getValidityLabel:function(dontCreate){if(!helper.isInStage(this,"RENDERED"))return null;var label=this.validityLabel&&this.viewContext.get(this.validityLabel);if(!label&&!dontCreate){var options={id:this.id+"-validity",viewContext:this.viewContext};if(label=new ValidityLabel(options),this.main.nextSibling){var nextSibling=this.main.nextSibling;label.insertBefore(nextSibling)}else label.appendTo(this.main.parentNode);this.validityLabel=label.id}return 8!==lib.ie&&7!==lib.ie||!label||lib.toggleClass(label.main.parentNode,"fuck-the-ie"),label},showValidity:function(validity){this.validity&&this.removeState("validity-"+this.validity.getValidState()),this.validity=validity,this.addState("validity-"+validity.getValidState());var label=this.getValidityLabel();if(label){var properties={target:this,focusTarget:this.getFocusTarget(),validity:validity};label.setProperties(properties)}},hideValidity:function(){var validity=new Validity;this.showValidity(validity)},showValidationMessage:function(validState,message){message=message||"";var validity=new Validity;validity.setCustomValidState(validState),validity.setCustomMessage(message),this.showValidity(validity)},dispose:function(){if(!helper.isInStage(this,"DISPOSED")){var validityLabel=this.getValidityLabel(!0);validityLabel&&validityLabel.dispose(),Control.prototype.dispose.apply(this,arguments)}}},lib.inherits(InputControl,Control),Schedule.defaultProperties={helpSelectedText:"投放时间段",helpText:"暂停时间段",dayTexts:["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],shortcut:shortcut()};var getTimeBodyMoveHandler,getTimeBodyUpHandler,timeTipTpl='<div id="${timeId}" class="${timeClass}">${time}</div><div id="${textId}" class="${textClass}">${text}</div>';Schedule.prototype={constructor:Schedule,type:"Schedule",createMain:function(options){return options.tagName?document.createElement(options.tagName):InputControl.prototype.createMain.call(this)},initOptions:function(options){var properties={};lib.extend(properties,Schedule.defaultProperties,options),this.setProperties(properties),null==this.rawValue&&this.setRawValue(initValue()),this.followTip={}},initStructure:function(){var me=this;this.main.tabIndex=0;var tpl='<input type="hidden" name="${name}" id="${inputId}"/><div class="${bodyClass}" id="${bodyId}"></div><div class="${headClass}"><div class="${helpClass}"><div class="${helpSelectedClass}"></div><div class="${helpTextClass}">${helpSelected}</div><div class="${helpUnselectedClass}"></div><div class="${helpTextClass}">${help}</div></div><div class="${shortcutClass}" id="${shortcutId}">${shortcutHtml}</div></div>';this.main.innerHTML=lib.format(tpl,{name:this.name,inputId:getId(me,"value-input"),headClass:getClass(me,"head"),bodyClass:getClass(me,"body"),helpClass:getClass(me,"help"),helpSelectedClass:getClass(me,"help-selected"),helpUnselectedClass:getClass(me,"help-unselected"),helpTextClass:getClass(me,"help-text"),shortcutClass:getClass(me,"shortcut"),shortcutId:getId(me,"shortcut"),bodyId:getId(me,"body"),helpSelected:me.helpSelectedText,help:me.helpText,shortcutHtml:getShortcutHtml(me)}),initBody(me)},initEvents:function(){var timebody=lib.g(getId(this,"time-body"));this.helper.addDOMEvent(timebody,"mousedown",timeBodyDownHandler),this.helper.addDOMEvent(timebody,"mouseover",timeOverHandler),this.helper.addDOMEvent(timebody,"mouseout",timeOutHandler),this.helper.addDOMEvent(lib.g(getId(this,"day-head")),"click",dayClickHandler);var shortcut=this.helper.getPart("shortcut");this.helper.addDOMEvent(shortcut,"click",shortcutClickHandler),this.helper.addDOMEvent(shortcut,"mouseover",lib.curry(shortcutOverOutHandler,!0)),this.helper.addDOMEvent(shortcut,"mouseout",lib.curry(shortcutOverOutHandler,!1)),this.helper.addDOMEvent(shortcut,"mousemove",shortcutMoveHandler)},setProperties:function(properties){var changes=InputControl.prototype.setProperties.call(this,properties),rawValueObj=changes.rawValue;rawValueObj&&this.stringifyValue(rawValueObj.oldValue)!==this.stringifyValue(rawValueObj.newValue)&&this.fire("change",{rawValue:this.rawValue})},repaint:helper.createRepaint(InputControl.prototype.repaint,{name:"rawValue",paint:function(schedule,rawValue){var value=schedule.stringifyValue(rawValue);lib.g(getId(schedule,"value-input")).value=null==value?"":value,repaintView(schedule,rawValue)}},{name:"disabled",paint:function(schedule,value){setDayCheckboxState(schedule,"disabled",value)}},{name:"readonly",paint:function(schedule,value){setDayCheckboxState(schedule,"readonly",value)}}),parseValue:function(value){for(var arr=[],step=24,i=0,len=value.length;len>i;i+=step){for(var inner=value.substring(i,i+step).split(""),innerOut=[],j=0;j<inner.length;j++)innerOut.push(inner[j]-0);arr.push(innerOut)}return arr},stringifyValue:function(rawValue){var arr=[];if(!rawValue)return null;for(var i=0,len=rawValue.length;len>i;i++)arr.push(rawValue[i].join(""));return arr.join("")},setRawValue:function(rawValue){this.setProperties({rawValue:rawValue})},getRawValue:function(){return this.rawValue},select:function(coord){dealValueByCoord(this,1,[].slice.call(arguments))},unselect:function(coord){dealValueByCoord(this,0,[].slice.call(arguments))},dispose:function(){helper.beforeDispose(this);var followTip=this.followTip;for(var key in followTip)followTip[key]&&document.body.removeChild(followTip[key]);helper.dispose(this),helper.afterDispose(this)}},lib.inherits(Schedule,InputControl),main.register(Schedule),window.Schedule=main}(window);